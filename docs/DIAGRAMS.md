# Asgard Platform - Diagrams & Visual Reference

**Complete Visual Guide to System Components and Data Flow**  
**Last Updated:** November 11, 2025  
**Version:** 1.0

---

## ğŸ“‹ Table of Contents

1. [Platform Overview Diagram](#platform-overview-diagram)
2. [Data Flow Diagrams](#data-flow-diagrams)
3. [Component Interaction Diagrams](#component-interaction-diagrams)
4. [Sequence Diagrams](#sequence-diagrams)
5. [Network Architecture](#network-architecture)
6. [Storage Layout](#storage-layout)
7. [Reference Tables](#reference-tables)

---

## Platform Overview Diagram

### Complete System Architecture

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                          ASGARD DATA PLATFORM                                 â•‘
â•‘                     Modern Data Lakehouse + ML Platform                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              API LAYER (FastAPI)                              â”‚
â”‚                         http://localhost:8000/docs                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  /datasourceâ”‚ /spark/     â”‚   /dbt/     â”‚  /feast/    â”‚  /mlops/    â”‚   â”‚
â”‚  â”‚  /datasink  â”‚  transform  â”‚  transform  â”‚  features   â”‚  training   â”‚   â”‚
â”‚  â”‚  /ingestion â”‚             â”‚             â”‚  /status    â”‚  /inference â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚             â”‚             â”‚             â”‚             â”‚
          â–¼             â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AIRBYTE    â”‚ â”‚    SPARK     â”‚ â”‚     DBT      â”‚ â”‚    FEAST     â”‚ â”‚   MLFLOW     â”‚
â”‚   Platform   â”‚ â”‚ K8s Operator â”‚ â”‚  + Trino     â”‚ â”‚Feature Store â”‚ â”‚ ML Tracking  â”‚
â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚ â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Sources  â”‚ â”‚ â”‚ â”‚  Driver  â”‚ â”‚ â”‚ â”‚   SQL    â”‚ â”‚ â”‚ â”‚ Registry â”‚ â”‚ â”‚ â”‚ Tracking â”‚ â”‚
â”‚ â”‚  - PG    â”‚ â”‚ â”‚ â”‚   Pod    â”‚ â”‚ â”‚ â”‚  Models  â”‚ â”‚ â”‚ â”‚  (SQL)   â”‚ â”‚ â”‚ â”‚  Server  â”‚ â”‚
â”‚ â”‚  - MySQL â”‚ â”‚ â”‚ â”‚          â”‚ â”‚ â”‚ â”‚          â”‚ â”‚ â”‚ â”‚          â”‚ â”‚ â”‚ â”‚          â”‚ â”‚
â”‚ â”‚  - API   â”‚ â”‚ â”‚ â”‚ Executorsâ”‚ â”‚ â”‚ â”‚  Trino   â”‚ â”‚ â”‚ â”‚ Offline  â”‚ â”‚ â”‚ â”‚ Registry â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚   Pods   â”‚ â”‚ â”‚ â”‚  Engine  â”‚ â”‚ â”‚ â”‚  Store   â”‚ â”‚ â”‚ â”‚          â”‚ â”‚
â”‚              â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚                â”‚                â”‚
       â”‚ Write          â”‚ Read/Write     â”‚ Read/Write     â”‚ Read           â”‚ Write
       â–¼                â–¼                â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA LAKEHOUSE (Apache Iceberg + S3)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     MEDALLION ARCHITECTURE                           â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚   BRONZE     â”‚â”€â”€â”€â”€â”€â–¶â”‚    SILVER    â”‚â”€â”€â”€â”€â”€â–¶â”‚     GOLD     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚  Raw Data    â”‚      â”‚   Cleaned    â”‚      â”‚  Aggregated  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚              â”‚      â”‚  Validated   â”‚      â”‚   Business   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ - customers  â”‚      â”‚ - customers_ â”‚      â”‚ - customer_  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ - transactionsâ”‚     â”‚   cleaned    â”‚      â”‚   metrics    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ - support_   â”‚      â”‚ - transactionsâ”‚     â”‚ - product_   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   tickets    â”‚      â”‚   _cleaned   â”‚      â”‚   analytics  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚              â”‚      â”‚              â”‚      â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Format: Parquet (Snappy compression)    â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Catalog: Nessie (Git-like versioning)   â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ Storage: S3 (Object Store)               â”‚              â”‚     â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                               â”‚
â”‚  Path Structure:                                                              â”‚
â”‚  s3://airbytedestination1/                                                   â”‚
â”‚    â””â”€â”€ iceberg/                                                               â”‚
â”‚        â”œâ”€â”€ bronze/{table}/data/*.parquet  â† Airbyte writes here             â”‚
â”‚        â”œâ”€â”€ silver/{table}/data/*.parquet  â† Spark writes here               â”‚
â”‚        â””â”€â”€ gold/{table}/data/*.parquet    â† DBT writes / Feast reads        â”‚
â”‚                                              NO COPY! Direct read            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   METADATA & ORCHESTRATION                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Nessie Catalog     â”‚  â”‚  PostgreSQL         â”‚  â”‚  Kubernetes         â”‚ â”‚
â”‚  â”‚  - Table metadata   â”‚  â”‚  - MLflow metadata  â”‚  â”‚  - Pod orchestrationâ”‚ â”‚
â”‚  â”‚  - Versioning       â”‚  â”‚  - Feast registry   â”‚  â”‚  - Service discoveryâ”‚ â”‚
â”‚  â”‚  - Commits/Branches â”‚  â”‚  - Airbyte config   â”‚  â”‚  - Resource mgmt    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagrams

### End-to-End Data Pipeline Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      COMPLETE DATA FLOW                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External Sources                                               ML Applications
      â”‚                                                               â–²
      â”‚                                                               â”‚
      â–¼                                                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚ PostgreSQL  â”‚                                                       â”‚
â”‚   MySQL     â”‚â”€â”€â”€â”                                                   â”‚
â”‚   APIs      â”‚   â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                                   â”‚
                  â”‚                                                   â”‚
                  â”‚  1. INGESTION (Airbyte)                          â”‚
                  â–¼                                                   â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
            â”‚  BRONZE  â”‚  â† Raw data as-is                           â”‚
            â”‚  Layer   â”‚    No transformations                        â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
                 â”‚                                                    â”‚
                 â”‚  2. CLEANSING (Spark)                             â”‚
                 â”‚     - Deduplication                                â”‚
                 â”‚     - Type casting                                 â”‚
                 â”‚     - Null handling                                â”‚
                 â–¼                                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
            â”‚  SILVER  â”‚  â† Clean, validated data                    â”‚
            â”‚  Layer   â”‚    Standardized schema                       â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
                 â”‚                                                    â”‚
                 â”‚  3. AGGREGATION (DBT + Trino)                     â”‚
                 â”‚     - Joins                                        â”‚
                 â”‚     - Aggregations                                 â”‚
                 â”‚     - Business metrics                             â”‚
                 â–¼                                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
            â”‚   GOLD   â”‚  â† Business-level metrics                   â”‚
            â”‚  Layer   â”‚    ML-ready features                         â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
                 â”‚                                                    â”‚
                 â”‚  4. FEATURE REGISTRATION (Feast)                  â”‚
                 â”‚     - Define feature views                         â”‚
                 â”‚     - S3 direct read (no copy!)                    â”‚
                 â–¼                                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
            â”‚ Feature  â”‚  â† Registered features                      â”‚
            â”‚  Store   â”‚    Time-travel queries                       â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
                 â”‚                                                    â”‚
                 â”‚  5. ML TRAINING (MLflow)                          â”‚
                 â”‚     - Fetch features                               â”‚
                 â”‚     - Train models                                 â”‚
                 â”‚     - Log experiments                              â”‚
                 â–¼                                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                              â”‚
            â”‚  Model   â”‚  â† Trained models                           â”‚
            â”‚ Registry â”‚    Versioned artifacts                       â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                              â”‚
                 â”‚                                                    â”‚
                 â”‚  6. INFERENCE                                      â”‚
                 â”‚     - Load model                                   â”‚
                 â”‚     - Make predictions                             â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase-by-Phase Data Transformation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: RAW INGESTION (Bronze Layer)                                      â”‚
â”‚                                                                             â”‚
â”‚  customers (PostgreSQL)        transactions (MySQL)      support (API)     â”‚
â”‚       â”‚                               â”‚                        â”‚            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                       â”‚                                                     â”‚
â”‚                   Airbyte Sync                                              â”‚
â”‚                       â”‚                                                     â”‚
â”‚                       â–¼                                                     â”‚
â”‚           s3://bucket/iceberg/bronze/                                       â”‚
â”‚           â”œâ”€â”€ customers/data/*.parquet       (100K rows)                   â”‚
â”‚           â”œâ”€â”€ transactions/data/*.parquet    (1.2M rows)                   â”‚
â”‚           â””â”€â”€ support_tickets/data/*.parquet (45K rows)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: DATA CLEANSING (Silver Layer)                                     â”‚
â”‚                                                                             â”‚
â”‚  Bronze Tables                                                              â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”‚  Spark SQL Transformations:                                        â”‚
â”‚       â”‚  - SELECT * WHERE email IS NOT NULL                                â”‚
â”‚       â”‚  - CAST(amount as DECIMAL(10,2))                                   â”‚
â”‚       â”‚  - TRIM(LOWER(email))                                              â”‚
â”‚       â”‚  - COALESCE(first_name, 'Unknown')                                 â”‚
â”‚       â–¼                                                                     â”‚
â”‚  s3://bucket/iceberg/silver/                                                â”‚
â”‚  â”œâ”€â”€ customers_cleaned/data/*.parquet       (98.5K rows, -1.5K invalid)   â”‚
â”‚  â”œâ”€â”€ transactions_cleaned/data/*.parquet    (1.18M rows, -20K invalid)    â”‚
â”‚  â””â”€â”€ support_tickets_cleaned/data/*.parquet (44K rows)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 3: BUSINESS METRICS (Gold Layer)                                     â”‚
â”‚                                                                             â”‚
â”‚  Silver Tables                                                              â”‚
â”‚       â”‚                                                                     â”‚
â”‚       â”‚  DBT + Trino Transformations:                                      â”‚
â”‚       â”‚  - JOIN customers + transactions                                   â”‚
â”‚       â”‚  - GROUP BY customer_id                                            â”‚
â”‚       â”‚  - Calculate aggregates (SUM, AVG, COUNT)                          â”‚
â”‚       â”‚  - Derive features (recency, frequency, value)                     â”‚
â”‚       â–¼                                                                     â”‚
â”‚  s3://bucket/iceberg/gold/                                                  â”‚
â”‚  â””â”€â”€ customer_metrics/data/*.parquet                                        â”‚
â”‚      Features per row:                                                      â”‚
â”‚      - total_purchases, customer_lifetime_value                            â”‚
â”‚      - avg_purchase_value, days_since_last_purchase                        â”‚
â”‚      - purchase_frequency, account_age_days                                â”‚
â”‚      - support_tickets, churned (target)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction Diagrams

### API Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client  â”‚                                                          â”‚FastAPI  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                                          â”‚ App     â”‚
     â”‚                                                               â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚  HTTP POST /spark/transform                                       â”‚
     â”‚  {job_name, sql_query, output_table}                             â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                                                    â”‚
     â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                          â”‚  Router          â”‚
     â”‚                                                          â”‚  (spark/router)  â”‚
     â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                    â”‚
     â”‚                                                                    â”‚ Validate
     â”‚                                                                    â”‚ Request
     â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                          â”‚  Service         â”‚
     â”‚                                                          â”‚  (service.py)    â”‚
     â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                    â”‚
     â”‚                                                                    â”‚ Create
     â”‚                                                                    â”‚ SparkApp
     â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                                          â”‚  Spark Operator  â”‚
     â”‚                                                          â”‚  (Kubernetes)    â”‚
     â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                                    â”‚
     â”‚                                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Response: {run_id, status, ...}                        â”‚  Driver Pod      â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (Created)       â”‚
     â”‚                                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  GET /spark/transform/{run_id}/status
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                                                    â”‚
     â”‚  Response: {status: "running", ...}                               â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚
```

### Spark Job Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SPARK JOB LIFECYCLE                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

API Request                Spark Operator              Driver Pod
     â”‚                            â”‚                        â”‚
     â”‚  Create SparkApplication   â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                        â”‚
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚  Create Driver Pod     â”‚
     â”‚                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚                        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                            â”‚                        â”‚  â”‚Initialize    â”‚
     â”‚                            â”‚                        â”œâ”€â–¶â”‚Spark Context â”‚
     â”‚                            â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚  Request Executors     â”‚
     â”‚                            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                            â”‚                        â”‚
     â”‚  Create Executor Pods      â”‚                        â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                        â”‚
     â”‚  â”‚Executor 1â”‚ â”‚Executor 2â”‚â”‚                        â”‚
     â”‚â—€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”¤                        â”‚
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚  Execute SQL Query     â”‚
     â”‚                            â”‚                        â”œâ”€â”
     â”‚                            â”‚                        â”‚ â”‚ Read from S3
     â”‚                            â”‚                        â”‚â—€â”˜ (Bronze/Silver)
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚                        â”œâ”€â”
     â”‚                            â”‚                        â”‚ â”‚ Transform Data
     â”‚                            â”‚                        â”‚â—€â”˜ (SQL Logic)
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚                        â”œâ”€â”
     â”‚                            â”‚                        â”‚ â”‚ Write to S3
     â”‚                            â”‚                        â”‚â—€â”˜ (Silver/Gold)
     â”‚                            â”‚                        â”‚
     â”‚                            â”‚  Job Complete          â”‚
     â”‚                            â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                            â”‚                        â”‚
     â”‚  Update Status: completed  â”‚                        â”‚
     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
     â”‚                            â”‚                        â”‚
```

---

## Sequence Diagrams

### Complete ML Workflow Sequence

```
User    API     Airbyte  Spark   DBT    Feast   MLflow   Model
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /datasourceâ”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /ingestion â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚ Sync  â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚â”€â”€â”€â”   â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚â—€â”€â”€â”˜   â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚ Write â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚â”€ to â”€â–¶â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚ Bronzeâ”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ job_id  â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /spark/transform   â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚ Read â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚Bronzeâ”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚ Writeâ”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚Silverâ”‚       â”‚        â”‚       â”‚
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚       â”‚        â”‚       â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ run_id  â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /dbt/transform     â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚ Read  â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚Silver â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚ Write â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚ Gold  â”‚        â”‚       â”‚
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚        â”‚       â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ transform_id    â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /feast/features    â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚ Read   â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚ Gold   â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚ (S3)   â”‚       â”‚
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚       â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ feature_view    â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /mlops/training    â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚ Train â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚ Model â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚â”€â”€â”€â”   â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚â—€â”€â”€â”˜   â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚ Log   â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚Metricsâ”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚Registerâ”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ job_id  â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚ POST /mlops/inference   â”‚      â”‚       â”‚        â”‚       â”‚
 â”œâ”€â”€â”€â”€â”€â”€â–¶â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚ Load
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚Model
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚Predict
 â”‚       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 â”‚â—€â”€â”€â”€â”€â”€â”€â”¤ predictions     â”‚      â”‚       â”‚        â”‚       â”‚
 â”‚       â”‚         â”‚       â”‚      â”‚       â”‚        â”‚       â”‚
```

---

## Network Architecture

### Kubernetes Service Mesh

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     KUBERNETES NAMESPACE: asgard                      â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      INGRESS LAYER                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  Ingress Controller (NGINX)                              â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - asgard.example.com  â†’ asgard-app:80                   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚  - mlflow.example.com  â†’ mlflow-service:5000             â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â”‚                                        â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚            â–¼                â–¼                â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Service     â”‚  â”‚  Service     â”‚  â”‚  Service     â”‚             â”‚
â”‚  â”‚  asgard-app  â”‚  â”‚  mlflow-svc  â”‚  â”‚  postgres    â”‚             â”‚
â”‚  â”‚  Port: 80    â”‚  â”‚  Port: 5000  â”‚  â”‚  Port: 5432  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚         â”‚                 â”‚                 â”‚                       â”‚
â”‚         â–¼                 â–¼                 â–¼                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Deployment  â”‚  â”‚  Deployment  â”‚  â”‚ StatefulSet  â”‚             â”‚
â”‚  â”‚  asgard-app  â”‚  â”‚  mlflow      â”‚  â”‚  postgres    â”‚             â”‚
â”‚  â”‚  Replicas: 2 â”‚  â”‚  Replicas: 1 â”‚  â”‚  Replicas: 1 â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   STORAGE (PVC + S3)                            â”‚ â”‚
â”‚  â”‚  - PersistentVolumeClaim (mlflow-artifacts)                    â”‚ â”‚
â”‚  â”‚  - PersistentVolumeClaim (postgres-data)                       â”‚ â”‚
â”‚  â”‚  - S3 (s3://airbytedestination1/iceberg/)                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVICE DISCOVERY (K8s DNS)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

asgard-app Pod
      â”‚
      â”œâ”€â”€ http://mlflow-service:5000           (MLflow API)
      â”œâ”€â”€ http://trino:8080                    (Trino queries)
      â”œâ”€â”€ postgresql://postgres:5432/feast     (Feast registry)
      â”œâ”€â”€ postgresql://postgres:5432/mlflow    (MLflow metadata)
      â”œâ”€â”€ http://airbyte-server:8001           (Airbyte API)
      â””â”€â”€ s3://airbytedestination1             (S3 storage)
```

---

## Storage Layout

### S3 Bucket Structure

```
s3://airbytedestination1/
â”œâ”€â”€ iceberg/
â”‚   â”œâ”€â”€ bronze/
â”‚   â”‚   â”œâ”€â”€ customers/
â”‚   â”‚   â”‚   â”œâ”€â”€ metadata/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ v1.metadata.json
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ v2.metadata.json
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ snap-{id}.avro
â”‚   â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚   â”‚       â”œâ”€â”€ 00000-0-{uuid}.parquet
â”‚   â”‚   â”‚       â””â”€â”€ 00001-1-{uuid}.parquet
â”‚   â”‚   â”œâ”€â”€ transactions/
â”‚   â”‚   â””â”€â”€ support_tickets/
â”‚   â”‚
â”‚   â”œâ”€â”€ silver/
â”‚   â”‚   â”œâ”€â”€ customers_cleaned/
â”‚   â”‚   â”‚   â”œâ”€â”€ metadata/
â”‚   â”‚   â”‚   â””â”€â”€ data/
â”‚   â”‚   â”‚       â””â”€â”€ *.parquet
â”‚   â”‚   â”œâ”€â”€ transactions_cleaned/
â”‚   â”‚   â””â”€â”€ support_tickets_cleaned/
â”‚   â”‚
â”‚   â””â”€â”€ gold/
â”‚       â”œâ”€â”€ customer_metrics/
â”‚       â”‚   â”œâ”€â”€ metadata/
â”‚       â”‚   â””â”€â”€ data/
â”‚       â”‚       â””â”€â”€ *.parquet  â† Feast reads from here!
â”‚       â”œâ”€â”€ product_analytics/
â”‚       â””â”€â”€ churn_predictions/
â”‚
â”œâ”€â”€ mlruns/
â”‚   â”œâ”€â”€ 0/  (Default experiment)
â”‚   â”œâ”€â”€ 1/  (customer_churn_prediction experiment)
â”‚   â”‚   â”œâ”€â”€ {run_id}/
â”‚   â”‚   â”‚   â”œâ”€â”€ artifacts/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ model.pkl
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MLmodel
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ plots/
â”‚   â”‚   â”‚   â””â”€â”€ metrics/
â”‚   â”‚   â”‚       â”œâ”€â”€ accuracy
â”‚   â”‚   â”‚       â””â”€â”€ f1_score
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ 2/  (product_recommendation experiment)
â”‚
â””â”€â”€ airbyte/
    â””â”€â”€ logs/
```

---

## Reference Tables

### Component Port Reference

| Component         | Internal Port | External Port       | Protocol   |
| ----------------- | ------------- | ------------------- | ---------- |
| Asgard API        | 80            | 8000 (port-forward) | HTTP       |
| MLflow Server     | 5000          | 5000 (port-forward) | HTTP       |
| PostgreSQL        | 5432          | -                   | PostgreSQL |
| Trino Coordinator | 8080          | -                   | HTTP       |
| Airbyte Server    | 8001          | 8001 (port-forward) | HTTP       |
| Spark Driver      | 4040          | 4040 (port-forward) | HTTP       |
| Spark UI          | 18080         | -                   | HTTP       |

### Iceberg Table Naming Convention

| Layer  | Namespace        | Table Pattern                | Example                            |
| ------ | ---------------- | ---------------------------- | ---------------------------------- |
| Bronze | `iceberg.bronze` | `{source_table}`             | `iceberg.bronze.customers`         |
| Silver | `iceberg.silver` | `{source_table}_cleaned`     | `iceberg.silver.customers_cleaned` |
| Gold   | `iceberg.gold`   | `{business_entity}_{metric}` | `iceberg.gold.customer_metrics`    |

### API Endpoint Summary

| Endpoint                 | Method | Purpose                | Response Time |
| ------------------------ | ------ | ---------------------- | ------------- |
| `/health`                | GET    | Platform health        | <50ms         |
| `/datasource`            | POST   | Create data source     | ~1s           |
| `/ingestion`             | POST   | Start sync job         | ~1s           |
| `/spark/transform`       | POST   | Submit Spark job       | ~2s           |
| `/dbt/transform`         | POST   | Run DBT model          | ~1s           |
| `/feast/features`        | POST   | Register features      | ~500ms        |
| `/mlops/training/upload` | POST   | Upload training script | ~2s           |
| `/mlops/inference`       | POST   | Make predictions       | <100ms        |

### Data Layer Comparison

| Aspect        | Bronze           | Silver             | Gold                 |
| ------------- | ---------------- | ------------------ | -------------------- |
| **Source**    | External systems | Bronze             | Silver               |
| **Quality**   | Raw, as-is       | Cleaned, validated | Aggregated, enriched |
| **Schema**    | Original         | Standardized       | ML-ready             |
| **Size**      | Largest          | Medium             | Smallest             |
| **Updates**   | Append-only      | Overwrite/append   | Usually overwrite    |
| **Consumers** | Spark            | DBT, analysts      | Feast, ML models     |
| **Retention** | Indefinite       | 6-12 months        | 3-6 months           |

### Typical Processing Times

| Operation            | Volume    | Time      | Notes              |
| -------------------- | --------- | --------- | ------------------ |
| Airbyte Sync         | 100K rows | 10-15 min | Depends on network |
| Spark Cleansing      | 100K rows | 5-10 min  | 2 executors        |
| DBT Aggregation      | 100K rows | 3-5 min   | Simple joins       |
| Feature Registration | -         | <1 min    | Metadata only      |
| Model Training       | 100K rows | 15-30 min | Random Forest      |
| Batch Inference      | 100K rows | 5-10 min  | Depends on model   |

---

## Summary

### Visual Guide Benefits

This diagram reference provides:

1. âœ… **System Architecture** - Complete platform overview
2. âœ… **Data Flow** - End-to-end data transformation
3. âœ… **Component Interaction** - How services communicate
4. âœ… **Sequence Diagrams** - Time-based operation flows
5. âœ… **Network Architecture** - Kubernetes service mesh
6. âœ… **Storage Layout** - S3 bucket organization
7. âœ… **Reference Tables** - Quick lookup for ports, endpoints, timings

### Next Steps

- **Understand the architecture**: [ARCHITECTURE.md](ARCHITECTURE.md)
- **Follow the workflow**: [USE_CASE_GUIDE.md](USE_CASE_GUIDE.md)
- **Test the APIs**: [API_TESTING_GUIDE.md](API_TESTING_GUIDE.md)
- **Debug issues**: [DEBUGGING_GUIDE.md](DEBUGGING_GUIDE.md)
